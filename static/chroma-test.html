<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chroma å‘é‡æœç´¢å¼•æ“æµ‹è¯•</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary-color: #4a90e2;
    --secondary-color: #6c63ff;
    --danger-color: #dc3545;
    --success-color: #28a745;
    --warning-color: #ffc107;
    --bg-color: #f8f9fa;
    --card-bg: #ffffff;
    --text-primary: #2c3e50;
    --text-secondary: #6c757d;
    --border-color: #dee2e6;
    --shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.15);
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    color: var(--text-primary);
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

/* Header */
.header {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 20px 30px;
    margin-bottom: 20px;
    box-shadow: var(--shadow-lg);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo i {
    font-size: 32px;
    color: var(--primary-color);
}

.logo h1 {
    font-size: 24px;
    font-weight: 600;
    color: var(--text-primary);
}

.api-base-url {
    font-size: 14px;
    color: var(--text-secondary);
}

.api-base-url code {
    background: var(--bg-color);
    padding: 4px 8px;
    border-radius: 4px;
    color: var(--primary-color);
    font-family: 'Courier New', monospace;
}

/* Tab Navigation */
.tab-nav {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 10px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    display: flex;
    gap: 10px;
}

.tab-btn {
    flex: 1;
    padding: 12px 20px;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.tab-btn:hover {
    background: var(--bg-color);
}

.tab-btn.active {
    background: var(--primary-color);
    color: white;
}

/* Main Content */
.main {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 30px;
    box-shadow: var(--shadow-lg);
    min-height: 600px;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Sections */
.section {
    margin-bottom: 40px;
    padding-bottom: 30px;
    border-bottom: 1px solid var(--border-color);
}

.section:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.section h2 {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 20px;
    color: var(--text-primary);
}

.section h3 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 15px;
    color: var(--text-primary);
}

/* Forms */
.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-primary);
}

.form-group input,
.form-group textarea {
    width: 100%;
    padding: 10px 15px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 14px;
    font-family: inherit;
    transition: border-color 0.3s ease;
}

.form-group input:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--primary-color);
}

.form-group textarea {
    min-height: 100px;
    resize: vertical;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

/* Buttons */
.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background: #3a7bc8;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(74, 144, 226, 0.3);
}

.btn-secondary {
    background: var(--secondary-color);
    color: white;
}

.btn-secondary:hover {
    background: #5a52d5;
    transform: translateY(-2px);
}

.btn-danger {
    background: var(--danger-color);
    color: white;
}

.btn-danger:hover {
    background: #c82333;
    transform: translateY(-2px);
}

.btn-warning {
    background: var(--warning-color);
    color: #333;
}

.btn-warning:hover {
    background: #e0a800;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3);
}

.button-group {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

/* Collections List */
.collections-list {
    margin-top: 20px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
}

.collection-card {
    background: var(--bg-color);
    padding: 15px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
}

.collection-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.collection-name {
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 8px;
}

.collection-count {
    font-size: 14px;
    color: var(--text-secondary);
}

/* Documents Container */
.documents-container {
    max-height: 500px;
    overflow-y: auto;
    padding-right: 10px;
}

.document-item {
    background: var(--bg-color);
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 15px;
    border: 1px solid var(--border-color);
}

.document-item h4 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 15px;
    color: var(--text-primary);
}

/* Search Results */
.search-results {
    margin-top: 30px;
}

.results-container {
    max-height: 600px;
    overflow-y: auto;
}

.result-item {
    background: var(--bg-color);
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 15px;
    border-left: 4px solid var(--primary-color);
}

.result-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.result-id {
    font-size: 12px;
    color: var(--text-secondary);
    font-family: monospace;
}

.result-distance {
    background: var(--success-color);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
}

.result-content {
    margin-bottom: 10px;
    line-height: 1.6;
}

.result-metadata {
    background: white;
    padding: 10px;
    border-radius: 4px;
    font-size: 12px;
    font-family: monospace;
    color: var(--text-secondary);
}

/* Result Box */
.result-box {
    margin-top: 20px;
    padding: 15px;
    border-radius: 8px;
    background: var(--bg-color);
    min-height: 50px;
    max-height: 300px;
    overflow-y: auto;
}

.result-box.success {
    background: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
}

.result-box.error {
    background: #f8d7da;
    border: 1px solid #f5c6cb;
    color: #721c24;
}

.result-box pre {
    margin: 0;
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 12px;
}

/* Logs Container */
.logs-container {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 20px;
    border-radius: 8px;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    max-height: 500px;
    overflow-y: auto;
}

.log-entry {
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid #3e3e3e;
}

.log-entry:last-child {
    border-bottom: none;
}

.log-timestamp {
    color: #858585;
    margin-bottom: 5px;
}

.log-method {
    display: inline-block;
    padding: 2px 6px;
    border-radius: 3px;
    font-weight: bold;
    margin-right: 10px;
}

.log-method.GET { background: #28a745; }
.log-method.POST { background: #007bff; }
.log-method.DELETE { background: #dc3545; }
.log-method.PUT { background: #ffc107; color: #000; }

.log-url {
    color: #61dafb;
}

.log-request, .log-response {
    margin-top: 10px;
    padding: 10px;
    background: #2d2d2d;
    border-radius: 4px;
}

.log-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
}

/* Loading Overlay */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.loading-overlay.show {
    display: flex;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Toast */
.toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    padding: 15px 20px;
    border-radius: 8px;
    color: white;
    font-size: 14px;
    display: none;
    animation: slideIn 0.3s ease;
    z-index: 10000;
    max-width: 400px;
}

.toast.show {
    display: block;
}

.toast.success {
    background: var(--success-color);
}

.toast.error {
    background: var(--danger-color);
}

.toast.warning {
    background: var(--warning-color);
    color: #333;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Info Text */
.info-text {
    color: var(--text-secondary);
    font-style: italic;
    text-align: center;
    padding: 20px;
}

/* Responsive */
@media (max-width: 768px) {
    .container {
        padding: 10px;
    }
    
    .header {
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }
    
    .tab-nav {
        flex-direction: column;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .collections-list {
        grid-template-columns: 1fr;
    }
}
/* ========== å‘é‡ä¿¡æ¯å±•ç¤ºæ ·å¼ ========== */

/* Header å‘é‡çŠ¶æ€æŒ‡ç¤ºå™¨ */
.header-info {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: flex-end;
}

.vector-status {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    padding: 8px 12px;
    background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
    border-radius: 8px;
}

.vector-status i {
    color: var(--secondary-color);
}

.status-label {
    color: var(--text-secondary);
    font-weight: 500;
}

.status-value {
    color: var(--text-primary);
    font-weight: 600;
}

.status-badge {
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
}

.status-badge.active {
    background: var(--success-color);
    color: white;
}

/* å‘é‡ä¿¡æ¯å¡ç‰‡ */
.vector-info-card {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
}

.vector-info-card h3 {
    color: var(--text-primary);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.vector-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.vector-info-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: var(--bg-color);
    border-radius: 8px;
    transition: transform 0.2s, box-shadow 0.2s;
}

.vector-info-item:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.info-icon {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    border-radius: 10px;
    color: white;
    font-size: 20px;
}

.info-content {
    flex: 1;
}

.info-title {
    font-size: 12px;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
}

.info-value {
    font-size: 14px;
    color: var(--text-primary);
    font-weight: 600;
}

/* æ·»åŠ æ–‡æ¡£ç»“æœå¢å¼ºæ ·å¼ */
.add-result-container {
    padding: 20px;
}

.result-section {
    margin-bottom: 25px;
    padding: 20px;
    background: var(--bg-color);
    border-radius: 8px;
}

.result-section h4 {
    color: var(--text-primary);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.info-grid {
    display: grid;
    gap: 15px;
}

.info-item {
    display: flex;
    align-items: center;
    gap: 10px;
}

.info-label {
    color: var(--text-secondary);
    font-weight: 500;
    min-width: 100px;
}

.info-value {
    color: var(--text-primary);
    font-weight: 600;
}

.vector-info {
    margin-bottom: 20px;
}

/* åµŒå…¥å‘é‡é¢„è§ˆ */
.embeddings-preview {
    margin-top: 20px;
}

.embeddings-preview h5 {
    color: var(--text-primary);
    margin-bottom: 15px;
    font-size: 14px;
}

.embeddings-table {
    background: white;
    border-radius: 8px;
    padding: 15px;
    overflow-x: auto;
}

.embedding-row {
    display: flex;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid var(--border-color);
}

.embedding-row:last-child {
    border-bottom: none;
}

.doc-label {
    min-width: 80px;
    font-weight: 600;
    color: var(--text-primary);
}

.embedding-values {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
    flex: 1;
}

.embedding-val {
    padding: 4px 8px;
    background: var(--bg-color);
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    color: var(--secondary-color);
    border: 1px solid var(--border-color);
}

.embedding-more {
    color: var(--text-secondary);
    font-style: italic;
    font-size: 12px;
    margin-left: 10px;
}

.raw-data-details {
    margin-top: 20px;
    padding: 15px;
    background: var(--bg-color);
    border-radius: 8px;
}

.raw-data-details summary {
    cursor: pointer;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 8px;
}

.raw-data-details pre {
    margin-top: 15px;
    padding: 15px;
    background: white;
    border-radius: 6px;
    overflow-x: auto;
    font-size: 12px;
}

/* æœç´¢ç»“æœå¢å¼ºæ ·å¼ */
.search-stats {
    display: flex;
    gap: 20px;
    padding: 20px;
    background: var(--bg-color);
    border-radius: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
}

.stat-item i {
    color: var(--primary-color);
}

.stat-item strong {
    color: var(--secondary-color);
}

/* æœç´¢ç»“æœé¡¹ */
.result-item {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: var(--shadow);
    transition: transform 0.2s, box-shadow 0.2s;
}

.result-item:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.result-item.rank-1 {
    border-left: 4px solid #ffd700;
}

.result-item.rank-2 {
    border-left: 4px solid #c0c0c0;
}

.result-item.rank-3 {
    border-left: 4px solid #cd7f32;
}

.result-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.result-rank {
    font-size: 24px;
    font-weight: 700;
    color: var(--text-secondary);
    min-width: 40px;
}

.result-similarity {
    flex: 1;
    max-width: 300px;
    margin-left: 20px;
}

.similarity-bar {
    height: 20px;
    background: var(--bg-color);
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 5px;
}

.similarity-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    transition: width 0.3s ease;
}

.similarity-text {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
}

.similarity-percent {
    font-weight: 700;
}

.similarity-label {
    text-transform: uppercase;
    font-weight: 500;
}

/* ç›¸ä¼¼åº¦ç­‰çº§é¢œè‰² */
.similarity-very-high .similarity-fill {
    background: linear-gradient(90deg, #28a745, #20c997);
}

.similarity-very-high .similarity-label {
    color: #28a745;
}

.similarity-high .similarity-fill {
    background: linear-gradient(90deg, #20c997, #17a2b8);
}

.similarity-high .similarity-label {
    color: #20c997;
}

.similarity-medium .similarity-fill {
    background: linear-gradient(90deg, #ffc107, #fd7e14);
}

.similarity-medium .similarity-label {
    color: #fd7e14;
}

.similarity-low-medium .similarity-fill {
    background: linear-gradient(90deg, #fd7e14, #dc3545);
}

.similarity-low-medium .similarity-label {
    color: #fd7e14;
}

.similarity-low .similarity-fill {
    background: linear-gradient(90deg, #dc3545, #bd2130);
}

.similarity-low .similarity-label {
    color: #dc3545;
}

/* æœç´¢ç»“æœå†…å®¹ */
.result-body {
    padding-left: 50px;
}

.result-content {
    color: var(--text-primary);
    line-height: 1.6;
    margin-bottom: 15px;
}

.result-content i {
    color: var(--text-secondary);
    margin-right: 8px;
}

.result-metadata {
    margin-bottom: 15px;
}

.result-metadata details {
    padding: 10px;
    background: var(--bg-color);
    border-radius: 6px;
}

.result-metadata summary {
    cursor: pointer;
    font-weight: 500;
    color: var(--text-secondary);
}

.result-metadata pre {
    margin-top: 10px;
    padding: 10px;
    background: white;
    border-radius: 4px;
    font-size: 12px;
    overflow-x: auto;
}

.result-footer {
    display: flex;
    gap: 20px;
    font-size: 12px;
    color: var(--text-secondary);
}

.result-id,
.result-distance {
    display: flex;
    align-items: center;
    gap: 5px;
}

/* å“åº”å¼ä¼˜åŒ– */
@media (max-width: 768px) {
    .header-info {
        align-items: center;
        width: 100%;
    }
    
    .vector-status {
        width: 100%;
        justify-content: center;
    }
    
    .vector-info-grid {
        grid-template-columns: 1fr;
    }
    
    .search-stats {
        flex-direction: column;
        gap: 10px;
    }
    
    .result-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .result-similarity {
        width: 100%;
        max-width: none;
        margin-left: 0;
    }
    
    .result-body {
        padding-left: 0;
    }
}
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <i class="fas fa-database"></i>
                <h1>Chroma å‘é‡æœç´¢æµ‹è¯•</h1>
            </div>
            <div class="header-info">
                <div class="vector-status">
                    <i class="fas fa-robot"></i>
                    <span class="status-label">å‘é‡æ¨¡å‹:</span>
                    <span class="status-value">text-embedding-3-small</span>
                    <span class="status-badge active">Active</span>
                </div>
                <div class="api-base-url">
                    <span>API Base URL: </span>
                    <code id="api-base-url">/api/v1/chroma</code>
                </div>
            </div>
        </header>

        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="collections">é›†åˆç®¡ç†</button>
            <button class="tab-btn" data-tab="documents">æ–‡æ¡£ç®¡ç†</button>
            <button class="tab-btn" data-tab="search">å‘é‡æœç´¢</button>
            <button class="tab-btn" data-tab="logs">è¯·æ±‚æ—¥å¿—</button>
        </nav>

        <main class="main">
            <!-- é›†åˆç®¡ç† Tab -->
            <div class="tab-content active" id="collections-tab">
                <div class="section">
                    <h2>åˆ›å»ºé›†åˆ</h2>
                    <div class="form-group">
                        <label for="create-collection-name">é›†åˆåç§°</label>
                        <input type="text" id="create-collection-name" placeholder="è¾“å…¥æ–°é›†åˆåç§°">
                    </div>
                    <div class="form-group">
                        <label for="create-collection-metadata">å…ƒæ•°æ® (JSONæ ¼å¼ï¼Œå¯é€‰)</label>
                        <textarea id="create-collection-metadata" placeholder='ä¾‹å¦‚: {"description": "æµ‹è¯•é›†åˆ", "type": "demo"}'></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="createCollection()">
                        <i class="fas fa-plus"></i> åˆ›å»ºé›†åˆ
                    </button>
                    <div id="create-collection-result" class="result-box"></div>
                </div>

                <div class="section">
                    <h2>é›†åˆåˆ—è¡¨</h2>
                    <button class="btn btn-primary" onclick="listCollections()">
                        <i class="fas fa-sync"></i> åˆ·æ–°åˆ—è¡¨
                    </button>
                    <div id="collections-list" class="collections-list">
                        <p class="info-text">ç‚¹å‡»"åˆ·æ–°åˆ—è¡¨"æŸ¥çœ‹æ‰€æœ‰é›†åˆ</p>
                    </div>
                </div>

                <div class="section">
                    <h2>è·å–é›†åˆä¿¡æ¯</h2>
                    <div class="form-group">
                        <label for="collection-name-info">é›†åˆåç§°</label>
                        <input type="text" id="collection-name-info" placeholder="è¾“å…¥é›†åˆåç§°">
                        <button class="btn btn-secondary" onclick="getCollectionInfo()">
                            <i class="fas fa-info-circle"></i> è·å–ä¿¡æ¯
                        </button>
                    </div>
                    <div id="collection-info-result" class="result-box"></div>
                </div>

                <div class="section">
                    <h2>åˆ é™¤é›†åˆ</h2>
                    <div class="form-group">
                        <label for="collection-name-delete">é›†åˆåç§°</label>
                        <input type="text" id="collection-name-delete" placeholder="è¾“å…¥è¦åˆ é™¤çš„é›†åˆåç§°">
                        <button class="btn btn-danger" onclick="deleteCollection()">
                            <i class="fas fa-trash"></i> åˆ é™¤é›†åˆ
                        </button>
                    </div>
                    <div id="collection-delete-result" class="result-box"></div>
                </div>
            </div>

            <!-- æ–‡æ¡£ç®¡ç† Tab -->
            <div class="tab-content" id="documents-tab">
                <div class="section">
                    <h2>æ·»åŠ æ–‡æ¡£</h2>
                    <div class="form-group">
                        <label for="add-collection-name">é›†åˆåç§°</label>
                        <input type="text" id="add-collection-name" placeholder="è¾“å…¥é›†åˆåç§°ï¼ˆä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰">
                    </div>
                    
                    <div class="documents-container" id="documents-container">
                        <div class="document-item" data-index="0">
                            <h4>æ–‡æ¡£ 1</h4>
                            <div class="form-group">
                                <label>æ–‡æ¡£å†…å®¹</label>
                                <textarea class="document-content" placeholder="è¾“å…¥æ–‡æ¡£å†…å®¹"></textarea>
                            </div>
                            <div class="form-group">
                                <label>å…ƒæ•°æ® (JSONæ ¼å¼ï¼Œå¯é€‰)</label>
                                <textarea class="document-metadata" placeholder='ä¾‹å¦‚: {"type": "article", "author": "å¼ ä¸‰"}'></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button class="btn btn-secondary" onclick="addDocumentField()">
                            <i class="fas fa-plus"></i> æ·»åŠ æ›´å¤šæ–‡æ¡£
                        </button>
                        <button class="btn btn-warning" onclick="generateTestData()">
                            <i class="fas fa-magic"></i> ç”Ÿæˆæµ‹è¯•æ•°æ®
                        </button>
                        <button class="btn btn-primary" onclick="submitDocuments()">
                            <i class="fas fa-upload"></i> æäº¤æ–‡æ¡£
                        </button>
                    </div>
                    <div id="add-documents-result" class="result-box"></div>
                </div>

                <div class="section">
                    <h2>åˆ é™¤æ–‡æ¡£</h2>
                    <div class="form-group">
                        <label for="delete-doc-collection">é›†åˆåç§°</label>
                        <input type="text" id="delete-doc-collection" placeholder="è¾“å…¥é›†åˆåç§°">
                    </div>
                    <div class="form-group">
                        <label for="delete-doc-ids">æ–‡æ¡£IDåˆ—è¡¨ (é€—å·åˆ†éš”ï¼Œå¯é€‰)</label>
                        <input type="text" id="delete-doc-ids" placeholder="ä¾‹å¦‚: doc1,doc2,doc3">
                    </div>
                    <div class="form-group">
                        <label for="delete-doc-where">å…ƒæ•°æ®è¿‡æ»¤æ¡ä»¶ (JSONæ ¼å¼ï¼Œå¯é€‰)</label>
                        <textarea id="delete-doc-where" placeholder='ä¾‹å¦‚: {"type": "article"}'></textarea>
                    </div>
                    <button class="btn btn-danger" onclick="deleteDocuments()">
                        <i class="fas fa-trash"></i> åˆ é™¤æ–‡æ¡£
                    </button>
                    <div id="delete-documents-result" class="result-box"></div>
                </div>
            </div>

            <!-- å‘é‡æœç´¢ Tab -->
            <div class="tab-content" id="search-tab">
                <!-- å‘é‡ç³»ç»Ÿä¿¡æ¯å¡ç‰‡ -->
                <div class="vector-info-card">
                    <h3><i class="fas fa-info-circle"></i> å‘é‡ç³»ç»Ÿä¿¡æ¯</h3>
                    <div class="vector-info-grid">
                        <div class="vector-info-item">
                            <div class="info-icon"><i class="fas fa-microchip"></i></div>
                            <div class="info-content">
                                <div class="info-title">åµŒå…¥æ¨¡å‹</div>
                                <div class="info-value">OpenAI text-embedding-3-small</div>
                            </div>
                        </div>
                        <div class="vector-info-item">
                            <div class="info-icon"><i class="fas fa-cube"></i></div>
                            <div class="info-content">
                                <div class="info-title">å‘é‡ç»´åº¦</div>
                                <div class="info-value">1536 ç»´</div>
                            </div>
                        </div>
                        <div class="vector-info-item">
                            <div class="info-icon"><i class="fas fa-calculator"></i></div>
                            <div class="info-content">
                                <div class="info-title">ç›¸ä¼¼åº¦è®¡ç®—</div>
                                <div class="info-value">ä½™å¼¦ç›¸ä¼¼åº¦</div>
                            </div>
                        </div>
                        <div class="vector-info-item">
                            <div class="info-icon"><i class="fas fa-tachometer-alt"></i></div>
                            <div class="info-content">
                                <div class="info-title">æ€§èƒ½ç‰¹å¾</div>
                                <div class="info-value">é«˜ç²¾åº¦ã€å¿«é€Ÿæ£€ç´¢</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2>å‘é‡ç›¸ä¼¼åº¦æœç´¢</h2>
                    <div class="search-form">
                        <div class="form-group">
                            <label for="search-collection">é›†åˆåç§°</label>
                            <input type="text" id="search-collection" placeholder="è¾“å…¥é›†åˆåç§°">
                        </div>
                        <div class="form-group">
                            <label for="search-query">æŸ¥è¯¢æ–‡æœ¬</label>
                            <textarea id="search-query" placeholder="è¾“å…¥è¦æœç´¢çš„æ–‡æœ¬å†…å®¹"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="search-n-results">è¿”å›ç»“æœæ•°é‡</label>
                                <input type="number" id="search-n-results" value="10" min="1" max="100">
                            </div>
                            <div class="form-group">
                                <label for="search-where">å…ƒæ•°æ®è¿‡æ»¤ (JSONï¼Œå¯é€‰)</label>
                                <input type="text" id="search-where" placeholder='ä¾‹å¦‚: {"type": "article"}'>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="performSearch()">
                            <i class="fas fa-search"></i> æ‰§è¡Œæœç´¢
                        </button>
                    </div>
                    
                    <div class="search-results">
                        <h3>æœç´¢ç»“æœ</h3>
                        <div id="search-results" class="results-container">
                            <p class="info-text">æœç´¢ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¯·æ±‚æ—¥å¿— Tab -->
            <div class="tab-content" id="logs-tab">
                <div class="section">
                    <h2>API è¯·æ±‚æ—¥å¿—</h2>
                    <div class="log-controls">
                        <button class="btn btn-secondary" onclick="clearLogs()">
                            <i class="fas fa-trash"></i> æ¸…ç©ºæ—¥å¿—
                        </button>
                        <label class="checkbox-label">
                            <input type="checkbox" id="auto-scroll" checked>
                            è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°
                        </label>
                    </div>
                    <div id="request-logs" class="logs-container">
                        <p class="info-text">API è¯·æ±‚å’Œå“åº”æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- åŠ è½½åŠ¨ç”» -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="spinner"></div>
        </div>

        <!-- æç¤ºæ¶ˆæ¯ -->
        <div id="toast" class="toast"></div>
    </div>

    <script>
// API åŸºç¡€é…ç½®
// æœ¬åœ°æµ‹è¯•ç”¨ï¼Œç›´æ¥å†™æ­»åç«¯åœ°å€
const API_BASE_URL = 'http://localhost:8000/api/v1/chroma';
let documentCounter = 1;
let requestLogs = [];

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
    initializeTabs();
    initializeEventListeners();
});

// åˆå§‹åŒ–é€‰é¡¹å¡åˆ‡æ¢
function initializeTabs() {
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetTab = button.dataset.tab;
            
            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            tabButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            
            // åˆ‡æ¢å†…å®¹æ˜¾ç¤º
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${targetTab}-tab`) {
                    content.classList.add('active');
                }
            });
        });
    });
}

// åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
function initializeEventListeners() {
    // Enteré”®æäº¤æœç´¢
    document.getElementById('search-query').addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            performSearch();
        }
    });
}

// æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
function showLoading() {
    document.getElementById('loading-overlay').classList.add('show');
}

// éšè—åŠ è½½åŠ¨ç”»
function hideLoading() {
    document.getElementById('loading-overlay').classList.remove('show');
}

// æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    toast.classList.add('show');
    
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// è®°å½•APIè¯·æ±‚
function logRequest(method, url, requestData, responseData, status) {
    const logEntry = {
        timestamp: new Date().toISOString(),
        method,
        url,
        requestData,
        responseData,
        status
    };
    
    requestLogs.unshift(logEntry);
    updateLogsDisplay();
}

// æ›´æ–°æ—¥å¿—æ˜¾ç¤º
function updateLogsDisplay() {
    const logsContainer = document.getElementById('request-logs');
    if (requestLogs.length === 0) {
        logsContainer.innerHTML = '<p class="info-text">API è¯·æ±‚å’Œå“åº”æ—¥å¿—å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>';
        return;
    }
    
    logsContainer.innerHTML = requestLogs.map(log => `
        <div class="log-entry">
            <div class="log-timestamp">${log.timestamp}</div>
            <div>
                <span class="log-method ${log.method}">${log.method}</span>
                <span class="log-url">${log.url}</span>
                <span style="color: ${log.status < 400 ? '#28a745' : '#dc3545'}"> [${log.status}]</span>
            </div>
            ${log.requestData ? `
                <div class="log-request">
                    <strong>Request:</strong>
                    <pre>${JSON.stringify(log.requestData, null, 2)}</pre>
                </div>
            ` : ''}
            <div class="log-response">
                <strong>Response:</strong>
                <pre>${JSON.stringify(log.responseData, null, 2)}</pre>
            </div>
        </div>
    `).join('');
    
    // è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°
    if (document.getElementById('auto-scroll').checked) {
        logsContainer.scrollTop = 0;
    }
}

// æ¸…ç©ºæ—¥å¿—
function clearLogs() {
    requestLogs = [];
    updateLogsDisplay();
    showToast('æ—¥å¿—å·²æ¸…ç©º');
}

// API è¯·æ±‚å°è£…
async function apiRequest(endpoint, method = 'GET', data = null) {
    const url = `${API_BASE_URL}${endpoint}`;
    const options = {
        method,
        headers: {
            'Content-Type': 'application/json',
        }
    };
    
    if (data && method !== 'GET') {
        options.body = JSON.stringify(data);
    }
    
    showLoading();
    
    try {
        const response = await fetch(url, options);
        const responseData = await response.json();
        
        // è®°å½•è¯·æ±‚
        logRequest(method, url, data, responseData, response.status);
        
        hideLoading();
        
        if (!response.ok) {
            throw new Error(responseData.message || responseData.detail || 'APIè¯·æ±‚å¤±è´¥');
        }
        
        return responseData;
    } catch (error) {
        hideLoading();
        throw error;
    }
}

// é›†åˆç®¡ç†åŠŸèƒ½
async function createCollection() {
    const collectionName = document.getElementById('create-collection-name').value.trim();
    if (!collectionName) {
        showToast('è¯·è¾“å…¥é›†åˆåç§°', 'warning');
        return;
    }
    
    const metadataText = document.getElementById('create-collection-metadata').value.trim();
    let metadata = null;
    
    if (metadataText) {
        try {
            const parsedMetadata = JSON.parse(metadataText);
            // ç¡®ä¿å…ƒæ•°æ®æ˜¯å¯¹è±¡ç±»å‹
            if (typeof parsedMetadata !== 'object' || parsedMetadata === null || Array.isArray(parsedMetadata)) {
                showToast('å…ƒæ•°æ®å¿…é¡»æ˜¯JSONå¯¹è±¡ï¼Œä¾‹å¦‚: {"description": "æµ‹è¯•é›†åˆ"}', 'error');
                return;
            }
            metadata = parsedMetadata;
        } catch (e) {
            showToast('å…ƒæ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„JSONå¯¹è±¡', 'error');
            return;
        }
    }
    
    try {
        const response = await apiRequest('/collection/create', 'POST', {
            collection_name: collectionName,
            metadata: metadata
        });
        
        const resultBox = document.getElementById('create-collection-result');
        resultBox.className = 'result-box success';
        resultBox.innerHTML = `<pre>${JSON.stringify(response.data, null, 2)}</pre>`;
        
        showToast(response.message);
        
        // æ¸…ç©ºè¾“å…¥æ¡†
        document.getElementById('create-collection-name').value = '';
        document.getElementById('create-collection-metadata').value = '';
        
        // è‡ªåŠ¨åˆ·æ–°é›†åˆåˆ—è¡¨
        await listCollections();
    } catch (error) {
        const resultBox = document.getElementById('create-collection-result');
        resultBox.className = 'result-box error';
        resultBox.textContent = error.message;
        showToast(error.message, 'error');
    }
}

async function listCollections() {
    try {
        const response = await apiRequest('/collection/list', 'POST', {});
        const collections = response.data;
        
        const listContainer = document.getElementById('collections-list');
        if (collections.length === 0) {
            listContainer.innerHTML = '<p class="info-text">æš‚æ— é›†åˆ</p>';
        } else {
            listContainer.innerHTML = collections.map(collection => `
                <div class="collection-card">
                    <div class="collection-name">ğŸ“ ${collection.name}</div>
                    <div class="collection-count">æ–‡æ¡£æ•°é‡: ${collection.count}</div>
                    ${collection.metadata ? `
                        <div class="collection-metadata">
                            å…ƒæ•°æ®: ${JSON.stringify(collection.metadata)}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }
        
        showToast(`æˆåŠŸè·å– ${collections.length} ä¸ªé›†åˆ`);
    } catch (error) {
        showToast(error.message, 'error');
    }
}

async function getCollectionInfo() {
    const collectionName = document.getElementById('collection-name-info').value.trim();
    if (!collectionName) {
        showToast('è¯·è¾“å…¥é›†åˆåç§°', 'warning');
        return;
    }
    
    try {
        const response = await apiRequest('/collection/info', 'POST', {
            collection_name: collectionName
        });
        
        const resultBox = document.getElementById('collection-info-result');
        resultBox.className = 'result-box success';
        resultBox.innerHTML = `<pre>${JSON.stringify(response.data, null, 2)}</pre>`;
        
        showToast(response.message);
    } catch (error) {
        const resultBox = document.getElementById('collection-info-result');
        resultBox.className = 'result-box error';
        resultBox.textContent = error.message;
        showToast(error.message, 'error');
    }
}

async function deleteCollection() {
    const collectionName = document.getElementById('collection-name-delete').value.trim();
    if (!collectionName) {
        showToast('è¯·è¾“å…¥é›†åˆåç§°', 'warning');
        return;
    }
    
    if (!confirm(`ç¡®å®šè¦åˆ é™¤é›†åˆ "${collectionName}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
        return;
    }
    
    try {
        const response = await apiRequest('/collection/delete', 'POST', {
            collection_name: collectionName
        });
        
        const resultBox = document.getElementById('collection-delete-result');
        resultBox.className = 'result-box success';
        resultBox.textContent = response.message;
        
        showToast(response.message);
        
        // æ¸…ç©ºè¾“å…¥æ¡†
        document.getElementById('collection-name-delete').value = '';
    } catch (error) {
        const resultBox = document.getElementById('collection-delete-result');
        resultBox.className = 'result-box error';
        resultBox.textContent = error.message;
        showToast(error.message, 'error');
    }
}

// æ–‡æ¡£ç®¡ç†åŠŸèƒ½
// æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨
function generateTestData() {
    // æµ‹è¯•æ–‡æ¡£å†…å®¹æ¨¡æ¿
    const testContents = [
        "äººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligence, AIï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œè‡´åŠ›äºåˆ›å»ºèƒ½å¤Ÿæ‰§è¡Œé€šå¸¸éœ€è¦äººç±»æ™ºèƒ½çš„ä»»åŠ¡çš„ç³»ç»Ÿã€‚",
        "æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„å­é¢†åŸŸï¼Œä½¿è®¡ç®—æœºèƒ½å¤Ÿä»æ•°æ®ä¸­å­¦ä¹ å¹¶æ”¹è¿›å…¶æ€§èƒ½ï¼Œè€Œæ— éœ€æ˜ç¡®ç¼–ç¨‹ã€‚",
        "æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä½¿ç”¨å¤šå±‚ç¥ç»ç½‘ç»œæ¥å­¦ä¹ æ•°æ®çš„å¤æ‚æ¨¡å¼ã€‚",
        "è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä½¿è®¡ç®—æœºèƒ½å¤Ÿç†è§£ã€è§£é‡Šå’Œç”Ÿæˆäººç±»è¯­è¨€ã€‚",
        "è®¡ç®—æœºè§†è§‰æ˜¯AIçš„ä¸€ä¸ªé¢†åŸŸï¼Œä½¿æœºå™¨èƒ½å¤Ÿä»æ•°å­—å›¾åƒæˆ–è§†é¢‘ä¸­è·å¾—é«˜çº§ç†è§£ã€‚",
        "å¼ºåŒ–å­¦ä¹ æ˜¯ä¸€ç§æœºå™¨å­¦ä¹ æ–¹æ³•ï¼Œé€šè¿‡ä¸ç¯å¢ƒçš„äº¤äº’æ¥å­¦ä¹ æœ€ä¼˜è¡Œä¸ºç­–ç•¥ã€‚",
        "å‘é‡æ•°æ®åº“æ˜¯ä¸“é—¨ç”¨äºå­˜å‚¨å’Œæ£€ç´¢é«˜ç»´å‘é‡æ•°æ®çš„æ•°æ®åº“ç³»ç»Ÿï¼Œå¸¸ç”¨äºç›¸ä¼¼æ€§æœç´¢ã€‚",
        "Transformeræ¶æ„å½»åº•æ”¹å˜äº†NLPé¢†åŸŸï¼Œæˆä¸ºäº†GPTå’ŒBERTç­‰æ¨¡å‹çš„åŸºç¡€ã€‚",
        "çŸ¥è¯†å›¾è°±æ˜¯ä¸€ç§ç”¨å›¾ç»“æ„å­˜å‚¨å®ä½“åŠå…¶å…³ç³»çš„çŸ¥è¯†è¡¨ç¤ºæ–¹æ³•ã€‚",
        "è”é‚¦å­¦ä¹ å…è®¸åœ¨ä¿æŠ¤æ•°æ®éšç§çš„åŒæ—¶è®­ç»ƒæœºå™¨å­¦ä¹ æ¨¡å‹ã€‚"
    ];
    
    // æµ‹è¯•å…ƒæ•°æ®æ¨¡æ¿
    const categories = ["æŠ€æœ¯", "ç§‘å­¦", "æ•™è‚²", "ç ”ç©¶", "åº”ç”¨"];
    const authors = ["å¼ ä¸‰", "æå››", "ç‹äº”", "èµµå…­", "é’±ä¸ƒ"];
    const types = ["article", "note", "research", "tutorial", "documentation"];
    
    // è·å–æˆ–è®¾ç½®é›†åˆåç§°
    const collectionNameInput = document.getElementById('add-collection-name');
    if (!collectionNameInput.value) {
        collectionNameInput.value = `test_collection_${Date.now()}`;
    }
    
    // æ¸…ç©ºç°æœ‰æ–‡æ¡£
    const container = document.getElementById('documents-container');
    container.innerHTML = '';
    documentCounter = 0;
    
    // éšæœºç”Ÿæˆ3-5ä¸ªæ–‡æ¡£
    const docCount = Math.floor(Math.random() * 3) + 3;
    
    for (let i = 0; i < docCount; i++) {
        documentCounter++;
        const randomContent = testContents[Math.floor(Math.random() * testContents.length)];
        const randomCategory = categories[Math.floor(Math.random() * categories.length)];
        const randomAuthor = authors[Math.floor(Math.random() * authors.length)];
        const randomType = types[Math.floor(Math.random() * types.length)];
        
        const metadata = {
            type: randomType,
            category: randomCategory,
            author: randomAuthor,
            timestamp: new Date().toISOString(),
            index: i + 1,
            tags: `${randomCategory.toLowerCase()},${randomType}`,  // æ”¹ä¸ºé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²
            source: "test_generator"
        };
        
        const newDocument = document.createElement('div');
        newDocument.className = 'document-item';
        newDocument.dataset.index = documentCounter;
        newDocument.innerHTML = `
            <h4>æ–‡æ¡£ ${documentCounter}</h4>
            <div class="form-group">
                <label>æ–‡æ¡£å†…å®¹</label>
                <textarea class="document-content">${randomContent}</textarea>
            </div>
            <div class="form-group">
                <label>å…ƒæ•°æ® (JSONæ ¼å¼ï¼Œå¯é€‰)</label>
                <textarea class="document-metadata">${JSON.stringify(metadata, null, 2)}</textarea>
            </div>
        `;
        container.appendChild(newDocument);
    }
    
    showToast(`å·²ç”Ÿæˆ ${docCount} ä¸ªæµ‹è¯•æ–‡æ¡£`, 'success');
    
    // æ»šåŠ¨åˆ°ç¬¬ä¸€ä¸ªæ–‡æ¡£
    const firstDoc = container.querySelector('.document-item');
    if (firstDoc) {
        firstDoc.scrollIntoView({ behavior: 'smooth' });
    }
}

function addDocumentField() {
    documentCounter++;
    const container = document.getElementById('documents-container');
    const newDocument = document.createElement('div');
    newDocument.className = 'document-item';
    newDocument.dataset.index = documentCounter;
    newDocument.innerHTML = `
        <h4>æ–‡æ¡£ ${documentCounter}</h4>
        <div class="form-group">
            <label>æ–‡æ¡£å†…å®¹</label>
            <textarea class="document-content" placeholder="è¾“å…¥æ–‡æ¡£å†…å®¹"></textarea>
        </div>
        <div class="form-group">
            <label>å…ƒæ•°æ® (JSONæ ¼å¼ï¼Œå¯é€‰)</label>
            <textarea class="document-metadata" placeholder='ä¾‹å¦‚: {"type": "article", "author": "å¼ ä¸‰"}'></textarea>
        </div>
    `;
    container.appendChild(newDocument);
    
    // æ»šåŠ¨åˆ°æ–°æ·»åŠ çš„æ–‡æ¡£
    newDocument.scrollIntoView({ behavior: 'smooth' });
}

async function submitDocuments() {
    const collectionName = document.getElementById('add-collection-name').value.trim();
    if (!collectionName) {
        showToast('è¯·è¾“å…¥é›†åˆåç§°', 'warning');
        return;
    }
    
    const documentItems = document.querySelectorAll('.document-item');
    const documents = [];
    
    for (const item of documentItems) {
        const content = item.querySelector('.document-content').value.trim();
        const metadataText = item.querySelector('.document-metadata').value.trim();
        
        if (content) {
            const doc = { content };
            
            if (metadataText) {
                try {
                    const parsedMetadata = JSON.parse(metadataText);
                    // ç¡®ä¿å…ƒæ•°æ®æ˜¯å¯¹è±¡ç±»å‹ï¼Œä¸æ¥å—æ•°å­—ã€å­—ç¬¦ä¸²ã€æ•°ç»„ç­‰
                    if (typeof parsedMetadata !== 'object' || parsedMetadata === null || Array.isArray(parsedMetadata)) {
                        showToast(`æ–‡æ¡£ ${item.dataset.index} çš„å…ƒæ•°æ®å¿…é¡»æ˜¯JSONå¯¹è±¡ï¼Œä¾‹å¦‚: {"key": "value"}`, 'error');
                        return;
                    }
                    doc.metadata = parsedMetadata;
                } catch (e) {
                    showToast(`æ–‡æ¡£ ${item.dataset.index} çš„å…ƒæ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„JSONå¯¹è±¡`, 'error');
                    return;
                }
            }
            
            documents.push(doc);
        }
    }
    
    if (documents.length === 0) {
        showToast('è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªæ–‡æ¡£å†…å®¹', 'warning');
        return;
    }
    
    try {
        const response = await apiRequest('/document/add', 'POST', {
            collection_name: collectionName,
            documents: documents
        });
        
        const resultBox = document.getElementById('add-documents-result');
        resultBox.className = 'result-box success';
        
        // æ„å»ºæ›´ä¸°å¯Œçš„ç»“æœå±•ç¤º
        let resultHTML = '<div class="add-result-container">';
        
        // åŸºæœ¬ä¿¡æ¯
        resultHTML += `
            <div class="result-section">
                <h4><i class="fas fa-info-circle"></i> åŸºæœ¬ä¿¡æ¯</h4>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">é›†åˆåç§°:</span>
                        <span class="info-value">${response.data.collection_name}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ·»åŠ æ•°é‡:</span>
                        <span class="info-value">${response.data.added_count} ä¸ªæ–‡æ¡£</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ–‡æ¡£ID:</span>
                        <span class="info-value">${response.data.document_ids.slice(0, 3).join(', ')}${response.data.document_ids.length > 3 ? '...' : ''}</span>
                    </div>
                </div>
            </div>
        `;
        
        // å‘é‡ä¿¡æ¯
        if (response.data.sample_embeddings && response.data.sample_embeddings.length > 0) {
            const embeddings = response.data.sample_embeddings;
            const embeddingDimension = embeddings[0].length;
            
            resultHTML += `
                <div class="result-section">
                    <h4><i class="fas fa-project-diagram"></i> å‘é‡ä¿¡æ¯</h4>
                    <div class="vector-info">
                        <div class="info-item">
                            <span class="info-label">å‘é‡æ¨¡å‹:</span>
                            <span class="info-value">text-embedding-3-small (OpenAI)</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">å‘é‡ç»´åº¦:</span>
                            <span class="info-value">${embeddingDimension} ç»´</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">å±•ç¤ºæ ·ä¾‹:</span>
                            <span class="info-value">å‰ ${embeddings.length} ä¸ªæ–‡æ¡£çš„å‘é‡</span>
                        </div>
                    </div>
                    
                    <div class="embeddings-preview">
                        <h5>å‘é‡é¢„è§ˆï¼ˆå‰10ä¸ªç»´åº¦ï¼‰</h5>
                        <div class="embeddings-table">
                            ${embeddings.map((embedding, idx) => `
                                <div class="embedding-row">
                                    <div class="doc-label">æ–‡æ¡£ ${idx + 1}:</div>
                                    <div class="embedding-values">
                                        ${embedding.slice(0, 10).map(val => `<span class="embedding-val">${val.toFixed(4)}</span>`).join('')}
                                        <span class="embedding-more">... +${embeddingDimension - 10} æ›´å¤šç»´åº¦</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // åŸå§‹æ•°æ®ï¼ˆæŠ˜å æ˜¾ç¤ºï¼‰
        resultHTML += `
            <details class="raw-data-details">
                <summary><i class="fas fa-code"></i> æŸ¥çœ‹åŸå§‹å“åº”æ•°æ®</summary>
                <pre>${JSON.stringify(response.data, null, 2)}</pre>
            </details>
        `;
        
        resultHTML += '</div>';
        resultBox.innerHTML = resultHTML;
        
        showToast(response.message);
        
        // æ¸…ç©ºè¡¨å•
        document.getElementById('add-collection-name').value = '';
        document.getElementById('documents-container').innerHTML = `
            <div class="document-item" data-index="0">
                <h4>æ–‡æ¡£ 1</h4>
                <div class="form-group">
                    <label>æ–‡æ¡£å†…å®¹</label>
                    <textarea class="document-content" placeholder="è¾“å…¥æ–‡æ¡£å†…å®¹"></textarea>
                </div>
                <div class="form-group">
                    <label>å…ƒæ•°æ® (JSONæ ¼å¼ï¼Œå¯é€‰)</label>
                    <textarea class="document-metadata" placeholder='ä¾‹å¦‚: {"type": "article", "author": "å¼ ä¸‰"}'></textarea>
                </div>
            </div>
        `;
        documentCounter = 1;
    } catch (error) {
        const resultBox = document.getElementById('add-documents-result');
        resultBox.className = 'result-box error';
        resultBox.textContent = error.message;
        showToast(error.message, 'error');
    }
}

async function deleteDocuments() {
    const collectionName = document.getElementById('delete-doc-collection').value.trim();
    if (!collectionName) {
        showToast('è¯·è¾“å…¥é›†åˆåç§°', 'warning');
        return;
    }
    
    const docIds = document.getElementById('delete-doc-ids').value.trim();
    const whereText = document.getElementById('delete-doc-where').value.trim();
    
    if (!docIds && !whereText) {
        showToast('è¯·æä¾›æ–‡æ¡£IDæˆ–å…ƒæ•°æ®è¿‡æ»¤æ¡ä»¶', 'warning');
        return;
    }
    
    const requestData = { collection_name: collectionName };
    
    if (docIds) {
        requestData.document_ids = docIds.split(',').map(id => id.trim());
    }
    
    if (whereText) {
        try {
            const parsedWhere = JSON.parse(whereText);
            // ç¡®ä¿è¿‡æ»¤æ¡ä»¶æ˜¯å¯¹è±¡ç±»å‹
            if (typeof parsedWhere !== 'object' || parsedWhere === null || Array.isArray(parsedWhere)) {
                showToast('è¿‡æ»¤æ¡ä»¶å¿…é¡»æ˜¯JSONå¯¹è±¡ï¼Œä¾‹å¦‚: {"type": "article"}', 'error');
                return;
            }
            requestData.where = parsedWhere;
        } catch (e) {
            showToast('å…ƒæ•°æ®è¿‡æ»¤æ¡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„JSONå¯¹è±¡', 'error');
            return;
        }
    }
    
    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™äº›æ–‡æ¡£å—ï¼Ÿ')) {
        return;
    }
    
    try {
        const response = await apiRequest('/document/delete', 'POST', requestData);
        
        const resultBox = document.getElementById('delete-documents-result');
        resultBox.className = 'result-box success';
        resultBox.textContent = response.message;
        
        showToast(response.message);
        
        // æ¸…ç©ºè¾“å…¥æ¡†
        document.getElementById('delete-doc-collection').value = '';
        document.getElementById('delete-doc-ids').value = '';
        document.getElementById('delete-doc-where').value = '';
    } catch (error) {
        const resultBox = document.getElementById('delete-documents-result');
        resultBox.className = 'result-box error';
        resultBox.textContent = error.message;
        showToast(error.message, 'error');
    }
}

// å‘é‡æœç´¢åŠŸèƒ½
async function performSearch() {
    const collectionName = document.getElementById('search-collection').value.trim();
    const queryText = document.getElementById('search-query').value.trim();
    const nResults = parseInt(document.getElementById('search-n-results').value);
    const whereText = document.getElementById('search-where').value.trim();
    
    if (!collectionName) {
        showToast('è¯·è¾“å…¥é›†åˆåç§°', 'warning');
        return;
    }
    
    if (!queryText) {
        showToast('è¯·è¾“å…¥æŸ¥è¯¢æ–‡æœ¬', 'warning');
        return;
    }
    
    const requestData = {
        collection_name: collectionName,
        query_text: queryText,
        n_results: nResults || 10
    };
    
    if (whereText) {
        try {
            const parsedWhere = JSON.parse(whereText);
            // ç¡®ä¿è¿‡æ»¤æ¡ä»¶æ˜¯å¯¹è±¡ç±»å‹
            if (typeof parsedWhere !== 'object' || parsedWhere === null || Array.isArray(parsedWhere)) {
                showToast('è¿‡æ»¤æ¡ä»¶å¿…é¡»æ˜¯JSONå¯¹è±¡ï¼Œä¾‹å¦‚: {"type": "article"}', 'error');
                return;
            }
            requestData.where = parsedWhere;
        } catch (e) {
            showToast('å…ƒæ•°æ®è¿‡æ»¤æ¡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„JSONå¯¹è±¡', 'error');
            return;
        }
    }
    
    try {
        const response = await apiRequest('/document/query', 'POST', requestData);
        const results = response.data;
        
        const resultsContainer = document.getElementById('search-results');
        
        if (results.documents.length === 0) {
            resultsContainer.innerHTML = '<p class="info-text">æœªæ‰¾åˆ°åŒ¹é…çš„æ–‡æ¡£</p>';
        } else {
            // æ·»åŠ å‘é‡æœç´¢ç»Ÿè®¡ä¿¡æ¯
            let searchHTML = `
                <div class="search-stats">
                    <div class="stat-item">
                        <i class="fas fa-chart-line"></i>
                        <span>æ‰¾åˆ° <strong>${results.total_results}</strong> ä¸ªç›¸å…³æ–‡æ¡£</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-robot"></i>
                        <span>å‘é‡æ¨¡å‹: <strong>text-embedding-3-small</strong></span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-cube"></i>
                        <span>å‘é‡ç»´åº¦: <strong>1536</strong> ç»´</span>
                    </div>
                </div>
            `;
            
            searchHTML += results.documents.map((doc, index) => {
                // è®¡ç®—ç›¸ä¼¼åº¦ç™¾åˆ†æ¯”å’Œç›¸ä¼¼åº¦ç­‰çº§
                const similarity = doc.distance !== null ? (1 - doc.distance) : 0;
                const similarityPercent = (similarity * 100).toFixed(1);
                let similarityClass = 'low';
                let similarityLabel = 'ä½';
                
                if (similarity > 0.9) {
                    similarityClass = 'very-high';
                    similarityLabel = 'æé«˜';
                } else if (similarity > 0.8) {
                    similarityClass = 'high';
                    similarityLabel = 'é«˜';
                } else if (similarity > 0.7) {
                    similarityClass = 'medium';
                    similarityLabel = 'ä¸­';
                } else if (similarity > 0.5) {
                    similarityClass = 'low-medium';
                    similarityLabel = 'ä¸­ä½';
                }
                
                return `
                    <div class="result-item rank-${index + 1}">
                        <div class="result-header">
                            <div class="result-rank">#${index + 1}</div>
                            <div class="result-similarity similarity-${similarityClass}">
                                <div class="similarity-bar">
                                    <div class="similarity-fill" style="width: ${similarityPercent}%"></div>
                                </div>
                                <div class="similarity-text">
                                    <span class="similarity-percent">${similarityPercent}%</span>
                                    <span class="similarity-label">${similarityLabel}</span>
                                </div>
                            </div>
                        </div>
                        <div class="result-body">
                            <div class="result-content">
                                <i class="fas fa-file-alt"></i>
                                ${doc.content}
                            </div>
                            ${doc.metadata ? `
                                <div class="result-metadata">
                                    <details>
                                        <summary><i class="fas fa-tags"></i> å…ƒæ•°æ®</summary>
                                        <pre>${JSON.stringify(doc.metadata, null, 2)}</pre>
                                    </details>
                                </div>
                            ` : ''}
                            <div class="result-footer">
                                <span class="result-id"><i class="fas fa-fingerprint"></i> ${doc.id.substring(0, 8)}...</span>
                                ${doc.distance !== null ? `
                                    <span class="result-distance"><i class="fas fa-ruler"></i> è·ç¦»: ${doc.distance.toFixed(6)}</span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            resultsContainer.innerHTML = searchHTML;
        }
        
        showToast(response.message);
    } catch (error) {
        const resultsContainer = document.getElementById('search-results');
        resultsContainer.innerHTML = `<p class="info-text" style="color: var(--danger-color);">æœç´¢å¤±è´¥: ${error.message}</p>`;
        showToast(error.message, 'error');
    }
}
    </script>
</body>
</html>